{% load static %}
<nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
    <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center" style="height: 70px;">
    <a class="navbar-brand brand-logo"  href={% url 'index' %}><img style="width: 60px;height: 60px;" src="{% static 'images/logo.png' %}" alt="logo" /></a>
    <a class="navbar-brand brand-logo-mini" href={% url 'index' %}><img style="width: 30px;height: 30px;" src="{% static 'images/logo.png' %}" alt="logo" /></a>
  </div>
  <div class="navbar-menu-wrapper d-flex align-items-stretch">
    <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
      <span class="mdi mdi-menu"></span>
     
    </button>
    <button class="navbar-toggler navbar-toggler align-self-center" style="color: black;" type="button" data-toggle="minimize">
      <h3>Barangay Pinagbuhatan Senior Citizen Care</h3>
     
    </button>
 
    <div class="search-field d-none d-xl-block">
    
    </div>
    <ul class="navbar-nav navbar-nav-right">
     
      <li class="nav-item nav-profile dropdown">
        <a class="nav-link font-weight-bold dropdown-toggle" id="profileDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
          <div class="nav-profile-img">
            <img src="{% static 'images/faces/face28.png' %}" alt="image">
          </div>
          <div class="nav-profile-text">
            <p class="mb-1 text-black">{{ username }}</p>
          </div>
        </a>
        <div class="dropdown-menu navbar-dropdown dropdown-menu-right p-0 border-0 font-size-sm" aria-labelledby="profileDropdown" data-x-placement="bottom-end">
          <div class="p-3 text-center bg-primary">
            <img class="img-avatar img-avatar48 img-avatar-thumb" src="{% static 'images/faces/face28.png' %}" alt="">
          </div>
          <div class="p-2">
            <h5 class="dropdown-header text-uppercase pl-2 text-dark">User Options</h5>
           <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="{% if user_type == 'HealthWorker' %}
            {% url 'health_worker_update' id=user_id %}
            {% else %}
            {% url 'admin_update' id=user_id %}
            {% endif %}">

              <span>Profile</span>
              <span class="p-0">
                <span class="badge badge-success">1</span>
                <i class="mdi mdi-account-outline ml-1"></i>
              </span>
            </a>
            <div role="separator" class="dropdown-divider"></div>
            <h5 class="dropdown-header text-uppercase  pl-2 text-dark mt-2">Actions</h5>
            <a class="dropdown-item py-1 d-flex align-items-center justify-content-between" href="{% url 'logout' %}">
              <span>Log Out</span>
              <i class="mdi mdi-logout ml-1"></i>
            </a>
          </div>
        </div>
      </li>
     
      
    </ul>
    <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
      <span class="mdi mdi-menu"></span>
    </button>
  </div>
</nav>
<!-- partial -->
<div class="container-fluid page-body-wrapper">
  <!-- partial:partials/_sidebar.html -->
  <nav class="sidebar sidebar-offcanvas" id="sidebar">
    <ul class="nav">
      <li class="nav-item nav-category">Home</li>
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href={% url 'index' %}>
          <span class="icon-bg"><i class="mdi mdi-cube menu-icon"></i></span>
          <span class="menu-title">Dashboard</span>
        </a>
      </li>
      {% if user_type == 'Admin' %}
<li class="nav-item">
<a class="nav-link font-weight-bold" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
  <span class="icon-bg"><i class="mdi mdi-crosshairs-gps menu-icon"></i></span>
  <span class="menu-title">Users</span>
  <i class="menu-arrow"></i>
</a>
<div class="collapse" id="ui-basic">
  <ul class="nav flex-column sub-menu">
      <li class="nav-item"> <a class="nav-link font-weight-bold" href="{% url 'admins' %}">Administrators</a></li>
      <li class="nav-item"> <a class="nav-link font-weight-bold" href="{% url 'healthworkers' %}">Health Workers</a></li>
      <li class="nav-item"> <a class="nav-link font-weight-bold" href="{% url 'userlogs' %}">Logs</a></li>
  </ul>
</div>
</li>
{% endif %}

      <li class="nav-item nav-category">System Management</li>
   
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="{% url 'citizens' %}">
          <span class="icon-bg"><i class="mdi mdi-chart-bar menu-icon"></i></span>
          <span class="menu-title">Data Profiling</span>
        </a>
      </li>
    
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="{% url 'smsnotifications' %}">
          <span class="icon-bg"><i class="mdi mdi-chart-bar menu-icon"></i></span>
          <span class="menu-title">SMS Notifications</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="{% url 'predictdis' %}">
          <span class="icon-bg"><i class="mdi mdi-chart-bar menu-icon"></i></span>
          <span class="menu-title">Predictive Analytics</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="{% url 'profile_reports' %}">
          <span class="icon-bg"><i class="mdi mdi-chart-bar menu-icon"></i></span>
          <span class="menu-title">Data Profiling Reports</span>
        </a>
      </li>
      
    
      
    </ul>
  </nav>

  
  
<!-- nav.html -->
<script>
  // JavaScript code for detecting tab change and logging out
  const logoutURL = "{% url 'logout' %}";  // Django's URL template tag

  let tabSwitched = false;

  window.onblur = function() {
    tabSwitched = true;
  };

  window.onfocus = function() {
    tabSwitched = false;
  };

  setInterval(function() {
    if (tabSwitched) {
      window.location.href = logoutURL;
    }
  }, 1000);
</script>
<script>
  // Function to get the current time in Asia/Manila
  function getManilaTime() {
      var now = new Date();
      return new Date(now.toLocaleString("en-US", {timeZone: "Asia/Manila"}));
  }
  
  // Function to create a cookie with the Manila timestamp and expiration time (in minutes)
  function setCookie(name, value, minutes) {
      var date = getManilaTime();
      date.setTime(date.getTime() + (minutes * 60 * 1000)); // Add minutes to Manila time
      var expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
  }
  
  // Function to get the value of a cookie by name
  function getCookie(name) {
      var nameEQ = name + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var cookiesArray = decodedCookie.split(';');
      for (var i = 0; i < cookiesArray.length; i++) {
          var cookie = cookiesArray[i].trim();
          if (cookie.indexOf(nameEQ) == 0) {
              return cookie.substring(nameEQ.length, cookie.length);
          }
      }
      return null;
  }
  
  // Function to delete a cookie by name
  function deleteCookie(name) {
      document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
  }
  
  // Function to show an alert every 15 minutes based on Manila time
  function alertEvery15Minutes() {
      var cookieName = "alertTimestamp";
  
      // Check if the cookie exists
      var alertCookie = getCookie(cookieName);
  
      if (!alertCookie) {
          // If the cookie doesn't exist, create it with Manila time and show the alert
          setCookie(cookieName, getManilaTime().toUTCString(), 15); // Cookie lasts for 15 minutes
          alert("This is your 15-minute alert (Manila Time)!");
          window.location.href = "{% url 'logout' %}";
      } else {
          // If the cookie exists, check if 15 minutes have passed
          var cookieAge = new Date(alertCookie);
          var currentTime = getManilaTime();
          if (currentTime - cookieAge >= 15 * 60 * 1000) {
              // 15 minutes have passed, delete the cookie, show the alert, and reset the cookie
              deleteCookie(cookieName);
              alert("This is your 15-minute alert (Manila Time)!");
              window.location.href = "{% url 'logout' %}";
              setCookie(cookieName, getManilaTime().toUTCString(), 15); // Reset the cookie
          }
      }
  }
  
  // Check for the alert every minute
  setInterval(alertEvery15Minutes, 60 * 1000); // Check every minute
  </script>